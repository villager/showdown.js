{
  "version": 3,
  "sources": ["../../../src/managers/login.ts"],
  "sourcesContent": ["import { toId, Net } from \"../lib\";\r\nimport * as urlModule from 'url';\r\nimport * as util from 'util';\r\n\r\nexport class LoginManager {\r\n    client: Client;\r\n    challenge: string;\r\n    challengekeyid: string;\r\n\tconstructor(client: Client) {\r\n        this.client = client;\r\n\t\tthis.challenge = '';\r\n\t\tthis.challengekeyid = '';\r\n\t}\r\n\tget getUrl() {\r\n\t\treturn util.format('https://%s/~~%s/action.php', 'play.pokemonshowdown.com', toId(this.client.id));\r\n\t}\r\n\tgetLogin(nick: string, pass: string, callback: any) {\r\n\t\tlet url = urlModule.parse(this.getUrl);\r\n\t\tlet requestOptions: AnyObject = {\r\n\t\t\thostname: url.hostname,\r\n\t\t\tport: url.port,\r\n\t\t\tpath: url.pathname,\r\n\t\t\tagent: false,\r\n\t\t\tdata: '',\r\n\t\t};\r\n\r\n\t\tif (!pass) {\r\n\t\t\trequestOptions.method = 'GET';\r\n\t\t\trequestOptions.path +=\r\n\t\t\t\t'?act=getassertion&userid=' +\r\n\t\t\t\ttoId(nick) +\r\n\t\t\t\t'&challengekeyid=' +\r\n\t\t\t\tthis.challengekeyid +\r\n\t\t\t\t'&challenge=' +\r\n\t\t\t\tthis.challenge;\r\n\t\t} else {\r\n\t\t\trequestOptions.data =\r\n\t\t\t\t'act=login&name=' +\r\n\t\t\t\ttoId(nick) +\r\n\t\t\t\t'&pass=' +\r\n\t\t\t\tpass +\r\n\t\t\t\t'&challengekeyid=' +\r\n\t\t\t\tthis.challengekeyid +\r\n\t\t\t\t'&challenge=' +\r\n\t\t\t\tthis.challenge;\r\n\t\t\trequestOptions.headers = {\r\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t'Content-Length': requestOptions.data.length,\r\n\t\t\t};\r\n\t\t}\r\n\t\tNet(requestOptions.hostname)\r\n\t\t\t.request(requestOptions)\r\n\t\t\t.then((str: any) => {\r\n\t\t\t\tif (str === ';') {\r\n\t\t\t\t\tthis.client.emit('renameFailure', {\r\n\t\t\t\t\t\treason: 'WRONG_PASSWORD',\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (str.length < 50) {\r\n\t\t\t\t\tthis.client.emit('renameFailure', {\r\n\t\t\t\t\t\treason: 'SERVER_ERROR',\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (str.includes('heavy load')) {\r\n\t\t\t\t\tthis.client.emit('renameFailure', {\r\n\t\t\t\t\t\treason: 'HEAVY_LOAD',\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tstr = JSON.parse(str.substr(1));\r\n\t\t\t\tif ((str as AnyObject).actionsuccess) {\r\n\t\t\t\t\tstr = (str as AnyObject).assertion;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.client.emit('renameFailure', {\r\n\t\t\t\t\t\treason: 'UNKNOW',\r\n\t\t\t\t\t\tdetails: JSON.stringify(str),\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (callback) callback.call(this, str);\r\n\t\t\t})\r\n\t\t\t.catch((e: any) => {\r\n\t\t\t\tthis.client.emit('renameFailure', {\r\n\t\t\t\t\treason: 'REQUEST',\r\n\t\t\t\t\tdetails: e,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\tlogin(name: string, pass: string) {\r\n\t\tthis.getLogin(name, pass, (token: string) => {\r\n\t\t\tif (token) {\r\n\t\t\t\tthis.client.send('/trn ' + name + ',0,' + token);\r\n\t\t\t\tthis.client.emit('logged', name);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAA0B;AAC1B,gBAA2B;AAC3B,WAAsB;AAEf,MAAM,aAAa;AAAA,EAIzB,YAAY,QAAgB;AACrB,SAAK,SAAS;AACpB,SAAK,YAAY;AACjB,SAAK,iBAAiB;AAAA,EACvB;AAAA,EACA,IAAI,SAAS;AACZ,WAAO,KAAK,OAAO,8BAA8B,gCAA4B,iBAAK,KAAK,OAAO,EAAE,CAAC;AAAA,EAClG;AAAA,EACA,SAAS,MAAc,MAAc,UAAe;AACnD,QAAI,MAAM,UAAU,MAAM,KAAK,MAAM;AACrC,QAAI,iBAA4B;AAAA,MAC/B,UAAU,IAAI;AAAA,MACd,MAAM,IAAI;AAAA,MACV,MAAM,IAAI;AAAA,MACV,OAAO;AAAA,MACP,MAAM;AAAA,IACP;AAEA,QAAI,CAAC,MAAM;AACV,qBAAe,SAAS;AACxB,qBAAe,QACd,kCACA,iBAAK,IAAI,IACT,qBACA,KAAK,iBACL,gBACA,KAAK;AAAA,IACP,OAAO;AACN,qBAAe,OACd,wBACA,iBAAK,IAAI,IACT,WACA,OACA,qBACA,KAAK,iBACL,gBACA,KAAK;AACN,qBAAe,UAAU;AAAA,QACxB,gBAAgB;AAAA,QAChB,kBAAkB,eAAe,KAAK;AAAA,MACvC;AAAA,IACD;AACA,wBAAI,eAAe,QAAQ,EACzB,QAAQ,cAAc,EACtB,KAAK,CAAC,QAAa;AACnB,UAAI,QAAQ,KAAK;AAChB,aAAK,OAAO,KAAK,iBAAiB;AAAA,UACjC,QAAQ;AAAA,QACT,CAAC;AACD;AAAA,MACD;AACA,UAAI,IAAI,SAAS,IAAI;AACpB,aAAK,OAAO,KAAK,iBAAiB;AAAA,UACjC,QAAQ;AAAA,QACT,CAAC;AACD;AAAA,MACD;AACA,UAAI,IAAI,SAAS,YAAY,GAAG;AAC/B,aAAK,OAAO,KAAK,iBAAiB;AAAA,UACjC,QAAQ;AAAA,QACT,CAAC;AACD;AAAA,MACD;AACA,YAAM,KAAK,MAAM,IAAI,OAAO,CAAC,CAAC;AAC9B,UAAK,IAAkB,eAAe;AACrC,cAAO,IAAkB;AAAA,MAC1B,OAAO;AACN,aAAK,OAAO,KAAK,iBAAiB;AAAA,UACjC,QAAQ;AAAA,UACR,SAAS,KAAK,UAAU,GAAG;AAAA,QAC5B,CAAC;AACD;AAAA,MACD;AACA,UAAI;AAAU,iBAAS,KAAK,MAAM,GAAG;AAAA,IACtC,CAAC,EACA,MAAM,CAAC,MAAW;AAClB,WAAK,OAAO,KAAK,iBAAiB;AAAA,QACjC,QAAQ;AAAA,QACR,SAAS;AAAA,MACV,CAAC;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EACA,MAAM,MAAc,MAAc;AACjC,SAAK,SAAS,MAAM,MAAM,CAAC,UAAkB;AAC5C,UAAI,OAAO;AACV,aAAK,OAAO,KAAK,UAAU,OAAO,QAAQ,KAAK;AAC/C,aAAK,OAAO,KAAK,UAAU,IAAI;AAAA,MAChC;AAAA,IACD,CAAC;AAAA,EACF;AACD;",
  "names": []
}
