{
  "version": 3,
  "sources": ["../../../src/managers/sender.ts"],
  "sourcesContent": ["export class SendManager {\r\n\t/**\r\n\t * @param {String|Array<String>} data\r\n\t * @param {Number} msgMaxLines\r\n\t * @param {function(String)} sendFunc\r\n\t * @param {function} destroyHandler\r\n\t */\r\n    data: string|string[];\r\n    msgMaxLines: number;\r\n    sendFunc: any;\r\n    status: string;\r\n    callback: any;\r\n    destroyHandler: any;\r\n    err: any;\r\n    interval: any;\r\n\tconstructor(data: string|string[], msgMaxLines: number, sendFunc: any, destroyHandler: any) {\r\n\t\tthis.data = data;\r\n\t\tthis.msgMaxLines = msgMaxLines;\r\n\t\tthis.sendFunc = sendFunc;\r\n\t\tthis.status = 'sending';\r\n\t\tthis.callback = null;\r\n\t\tthis.destroyHandler = destroyHandler;\r\n\t\tthis.err = null;\r\n\t\tthis.interval = null;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tlet data = this.data as string[];\r\n\t\tif (!(data instanceof Array)) {\r\n\t\t\tdata = [(data as string).toString()];\r\n\t\t} else {\r\n\t\t\tdata = data.slice();\r\n\t\t}\r\n\t\tconst nextToSend = () => {\r\n\t\t\tif (!data.length) {\r\n\t\t\t\tclearInterval(this.interval);\r\n\t\t\t\tthis.interval = null;\r\n\t\t\t\tthis.finalize();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst toSend = [];\r\n\t\t\tconst firstMsg = data.shift() as string;\r\n\t\t\ttoSend.push(firstMsg);\r\n\t\t\tlet roomToSend = '';\r\n\t\t\tif (firstMsg.indexOf('|') >= 0) {\r\n\t\t\t\troomToSend = firstMsg.split('|')[0];\r\n\t\t\t}\r\n\t\t\twhile (data.length > 0 && toSend.length < this.msgMaxLines) {\r\n\t\t\t\tconst subMsg = data[0];\r\n\t\t\t\tif (subMsg.split('|')[0] !== roomToSend) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoSend.push(subMsg.split('|').slice(1).join('|'));\r\n\t\t\t\t\tdata.shift();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sendFunc(toSend.join('\\n'));\r\n\t\t};\r\n\t\tthis.interval = setInterval(nextToSend.bind(this), 2000);\r\n\t\tnextToSend.call(this);\r\n\t}\r\n\r\n\tfinalize() {\r\n\t\tthis.status = 'finalized';\r\n\t\tif (typeof this.callback === 'function') this.callback(this.err);\r\n\t\tif (typeof this.destroyHandler === 'function') this.destroyHandler(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {function} callback\r\n\t */\r\n\tthen(callback: any) {\r\n\t\tif (this.status !== 'sending') {\r\n\t\t\treturn callback(this.err);\r\n\t\t} else {\r\n\t\t\tthis.callback = callback;\r\n\t\t}\r\n\t}\r\n\r\n\tkill() {\r\n\t\tif (this.interval) clearInterval(this.interval);\r\n\t\tthis.interval = null;\r\n\t\tthis.err = new Error('Send Manager was killed');\r\n\t\tthis.finalize();\r\n\t}\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAO,MAAM,YAAY;AAAA,EAexB,YAAY,MAAuB,aAAqB,UAAe,gBAAqB;AAC3F,SAAK,OAAO;AACZ,SAAK,cAAc;AACnB,SAAK,WAAW;AAChB,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,iBAAiB;AACtB,SAAK,MAAM;AACX,SAAK,WAAW;AAAA,EACjB;AAAA,EAEA,QAAQ;AACP,QAAI,OAAO,KAAK;AAChB,QAAI,EAAE,gBAAgB,QAAQ;AAC7B,aAAO,CAAE,KAAgB,SAAS,CAAC;AAAA,IACpC,OAAO;AACN,aAAO,KAAK,MAAM;AAAA,IACnB;AACA,UAAM,aAAa,MAAM;AACxB,UAAI,CAAC,KAAK,QAAQ;AACjB,sBAAc,KAAK,QAAQ;AAC3B,aAAK,WAAW;AAChB,aAAK,SAAS;AACd;AAAA,MACD;AACA,YAAM,SAAS,CAAC;AAChB,YAAM,WAAW,KAAK,MAAM;AAC5B,aAAO,KAAK,QAAQ;AACpB,UAAI,aAAa;AACjB,UAAI,SAAS,QAAQ,GAAG,KAAK,GAAG;AAC/B,qBAAa,SAAS,MAAM,GAAG,EAAE,CAAC;AAAA,MACnC;AACA,aAAO,KAAK,SAAS,KAAK,OAAO,SAAS,KAAK,aAAa;AAC3D,cAAM,SAAS,KAAK,CAAC;AACrB,YAAI,OAAO,MAAM,GAAG,EAAE,CAAC,MAAM,YAAY;AACxC;AAAA,QACD,OAAO;AACN,iBAAO,KAAK,OAAO,MAAM,GAAG,EAAE,MAAM,CAAC,EAAE,KAAK,GAAG,CAAC;AAChD,eAAK,MAAM;AAAA,QACZ;AAAA,MACD;AACA,WAAK,SAAS,OAAO,KAAK,IAAI,CAAC;AAAA,IAChC;AACA,SAAK,WAAW,YAAY,WAAW,KAAK,IAAI,GAAG,GAAI;AACvD,eAAW,KAAK,IAAI;AAAA,EACrB;AAAA,EAEA,WAAW;AACV,SAAK,SAAS;AACd,QAAI,OAAO,KAAK,aAAa;AAAY,WAAK,SAAS,KAAK,GAAG;AAC/D,QAAI,OAAO,KAAK,mBAAmB;AAAY,WAAK,eAAe,IAAI;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKA,KAAK,UAAe;AACnB,QAAI,KAAK,WAAW,WAAW;AAC9B,aAAO,SAAS,KAAK,GAAG;AAAA,IACzB,OAAO;AACN,WAAK,WAAW;AAAA,IACjB;AAAA,EACD;AAAA,EAEA,OAAO;AACN,QAAI,KAAK;AAAU,oBAAc,KAAK,QAAQ;AAC9C,SAAK,WAAW;AAChB,SAAK,MAAM,IAAI,MAAM,yBAAyB;AAC9C,SAAK,SAAS;AAAA,EACf;AACD;",
  "names": []
}
